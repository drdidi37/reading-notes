## 1 网络应用原理

这里网络应用只应用软件。一般来说，我们并不需要在网络核心设备例如路由器、交换机上编写应用程序。并且网络核心设备也不在应用层上起作用，一般是在较低层，网络层以下起作用。我们一般只需要在端系统编写软件。

### 1.1 网络应用体系结构

有两种体系结构：

- 客户-服务体系结构：有一个总是打开的主机，称为服务器，它服务于许多其他称为客户的主机请求。
- P2P体系结构：对位于数据中心的服务器有最小的依赖，或没有依赖。它是用户到用户（对等方到对等方）之间的通信，不依赖于服务器。一个显著的特性是**自扩展性**，虽然对等方到对等方之间的通信产生了负载，但同时也增加了系统的服务能力。

### 1.2 进程通信

用操作系统的术语来说，进行通信的实际上是进程，而不是程序。一个进程可以被认定为运行在端系统中的一个程序。进程间的通信有两类：

- 运行在同一个端系统上的不同进程间的通信，规则由操作系统提供；
- 运行在不同端系统上的两个进程，通过计算机网络交换报文，实现相互通信；

#### 1.2.1 客户服务进程

在一对进程之间的通信会话场景中，发起通信的进程被标识为客户，在会话开始时等待联系的进程是服务器。

#### 1.2.2 进程与计算机网络之间的接口

进程通过一个称为**套接字（socket）**的软件接口向网络发送报文和从网络接收报文。套接字是同一台主机内应用层与运输层之间的接口。套接字也被称为**应用编程接口（Application Programming Interface，API）**，用来建立网络应用程序的可编程接口。

#### 1.2.3 进程寻址

接收进程需要有一个地址，这样才能实现一台主机上的进程向另一台主机上的进程发送分组。需要有以下两个信息来标识接收进程：

- 主机的地址，IP地址
- 在目的主机中指定接收进程的标识符，端口号，Web程序为80，SMTP为25

### 1.3 可供应用程序使用的运输服务

运输服务是指运输层协议能够为调用它的应用程序提供什么样的服务，一般包含以下几个方面

- 可靠数据传输，确保数据在传输过程中没有丢失；
- 吞吐量，运输协议的吞吐量应大于等于应用程序的吞吐量；
- 定时，发送方与接收方之间的延迟；
- 安全性，发送前加密，交付前解密，防止被其他进程观察或窃取；

### 1.4 因特网提供的运输服务

提供了两种运输层协议：

- TCP：面向面向连接服务与可靠数据传输服务；
  - 面向连接服务：在应用层报文开始流动之前，客户端与服务器之间会先建立一个TCP连接，当发送完成后，拆除该连接。
- UDP：无连接的，不可靠的数据传输服务；

*ps：TCP、UDP没有提供加密机制，但应用程序可以使用TLS，对内容进行加密。*

运输层协议不能提供吞吐量以及定时方面的保证，只能通过一些设计来尽可能应对这种保证的缺乏。

## 1.5 应用层协议

应用层协议定义了以下内容：

- 交换的报文类型，例如请求报文和响应报文；
- 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的；
- 字段的语义，即这些字段中信息的含义；
- 确定一个进程何时以及如何发送报文，对报文进行响应的规则。

## 2 Web和HTTP

### 2.1 HTTP 概述

超文本传输协议（HyperText Transfer Protocol，HTTP），是 Web 的核心，有两个程序实现：客户程序、服务程序。

HTTP 定义了 Web 客户向 Web 服务器请求 Web 页面的方式，以及服务器向客户传送 Web 页面的方式。

HTTP 是一个无状态的协议。

发展史：

- 20世纪90年代早期：HTTP/1.0
- 截止到2020年：HTTP1.1
- 现在，越来越多的浏览器与服务器开始支持 HTTP/2.0

### 2.2 非持续连接与持续连接

- 非持续连接：每个请求/响应对都是通过一个单独的 TCP 连接发送。

- 持续连接：所有请求/响应对都是由相同的 TCP 连接发送。

在非持续连接中，每个 TCP 连接都需要花费两个 RTT 时间以及服务器传输数据/文件的时间。

- RTT 时间：往返时间（Round-Trip Time），即一个短分组从客户到服务器然后再返回客户所花费的时间。这里强调是短分组，感觉是因为要忽略分组本身的传输时间。

在 HTTP/1.0 中采用的是非持续连接，HTTP/1.1 开始，有了持续连接。通常情况下，一条连接经过一段时间后仍未被使用，该连接就会关闭。

### 2.3 HTTP 报文格式

#### 2.3.1 请求报文

请求行：方法 sp URL sp 版本 cr lf

首部行：首部字段名: sp 值 cr lf

空行：cr lf

实体体

#### 2.3.2 响应报文

状态行：版本 sp 状态码 sp 短语 cr lf

首部行：首部字段名: sp 值 cr lf

空行：cr lf

实体体

#### 2.3.3 常见的状态码和相关短语

| 状态码 | 短语                  | 含义                                                         |
| ------ | --------------------- | ------------------------------------------------------------ |
| 200    | OK                    | 请求成功                                                     |
| 301    | Moved Permanently     | 请求的对象已经被永久转移了，新的 URL 定义在响应报文的“Location:”首部行中。客户软件将自动获取新的 URL。 |
| 400    | Bad Request           | 通用的差错代码，表示服务器不能理解该请求。                   |
| 404    | Not Found             | 被请求的文档不在服务器上。                                   |
| 505    | Version Not Supported | 服务器不支持请求报文使用的 HTTP 版本。                       |

关于首部行的文献：Krishnamurty 2001