## 1 什么是因特网

从两方面来说：

1. 具体构成：构成因特网的基本硬件以及软件组件
2. 服务描述：为分布式应用提供服务的联网基础设施

### 1.1 具体构成

端系统 <=> 通信链路、分组交换机 <=> 端系统

#### 1.1.1 端系统

接入网络的设备

#### 1.1.2 通信链路

同轴电缆、铜线、光纤、无线电频谱

传输速率：bit/s，bps

分组：数据通过通信链路传输时，需要对数据进行分段，每段数据都需要携带首部字段，发送到目的端系统，然后在那里装配成初始数据。

#### 1.1.3 分组交换机

连接不同的通信链路。常见的有：

- 路由器：用于网络核心
- 链路交换机：用于接入网中

路径：分组传输过程中，经过的通信链路以及分组交换机

### 1.2 服务描述

#### 1.2.1 因特网服务供应商（Internet Service Provider，ISP）

端系统通过 ISP 连接因特网

低层 ISP 连接高层 ISP

高层 ISP 之间直接互联

#### 1.2.2 协议

两个或多个通信实体之间交换报文的格式和顺序，以及报文的发送/接受或其他事件所采取的操作

TCP：传输控制协议

IP：网际协议

套接字接口：运行在一个端系统上的程序请求因特网基础设施向运行在另一个端系统的特定目的地程序交付数据

#### 1.2.3 问题：从计算机网络的角度回答在浏览器中输入一个地址后发生了什么？

请求端系统：TCP 连接请求

目的端系统：TCP 连接请求响应

请求端系统：GET http://xxx.com

目的端系统：返回相应资源

## 2 网络边缘

字面意思，位于因特网边缘的端系统（主机）。主机分为两类：

- 客户端
- 服务器

数以百万计服务器组成数据中心。云计算其实就是由数据中心提供。

### 2.1 接入网

端系统物理连接到其边缘路由器的网络。边缘路由器是端系统到其他任何远程端系统路径上的第一台路由器，也就是其通信链路上的第一台路由器。

#### 2.1.1 家庭接入

##### 2.1.1.1 数据用户线（Digital Subscriber Line，DSL）

住宅从电话公司处获取 DSL 接入因特网。

DSLAM：数字用户线复用器

家庭 PC => DSL 调制解调器 => 中心局 DSLAM 进行数据交换

通过分频器，分隔数据信号与电话信号。

##### 2.1.1.2 电缆

住宅从有线电视获得电缆接入因特网。一般是光纤、同轴电缆混合，称为混合光纤同轴系统（HFC）。

家庭PC => 电缆调制解调器 => CMTS 将模拟信号转换为数字信号

##### 2.1.1.3 光纤到户（Fiber To The Home，FTTH）

从本地中心局直接到家庭的光纤路径。速率高，大约每秒千兆比特。

光纤分布网络：

- 直接光纤：从本地中心局到每户分别设置一根光纤

- 分布式：多户共享一根光纤
  - 有源光纤网络（AON）：以太网
  - 无源光纤网络（PON）：每个家庭光纤网络端接器（ONT） => 光纤分配器 => 共享光纤 => 中心局光纤线路端接器（OLT），提供光电信号转换

##### 2.1.1.4 5G 固定式无线

数据以无线的方式从供应商基站发送到家中的调制解调器中。

无线路由器 => 调制解调器

### 2.2 物理媒介

数据通过传播电磁波或光脉冲的方式跨越某种物理媒介。物理媒介分为两种类型：

- 导引型媒介：电波沿固体媒介前行，例如光缆、双绞铜线、同轴电缆
- 非导引型媒介：电波在空气或外层空间中传播，例如无线局域网、数字卫星

#### 2.2.1 双绞铜线

两根绝缘铜线以规则的螺旋状排列，常用于电话线，价格便宜。

#### 2.2.2 同轴电缆

由两根同轴导体组层，有特殊的绝缘体与保护层，常用于电视系统。

#### 2.2.3 光纤

一种细而柔软的，能够引导光脉冲的媒介。每个脉冲表示一个比特，有极高的传输速率。

#### 2.2.4 陆地无线信道

使用电磁频谱承载信号，分为三类：

- 运行在很短距离，如1m或2m
- 运行在局域，跨越十到几百米
- 运行在广域，跨越数万米

#### 2.2.5 卫星无线信道

一颗卫星会连接地球上的两个或多个微波发射器/接收器（地面站）。该卫星在一个频段上接受传输，并在另一个频段上发射信号。常用的有两种卫星：

- 同步卫星
- 近地轨道卫星

## 3 网络核心

### 3.1 分组交换

分组以等同于最大传输速率的速度通过通信链路。某源端系统或分组交换机经过一条链路发送一个 *L bit* 的分组，链路的传输速率为 *R bps*，则传输分组的时间为 *L / R s*

#### 3.1.1 存储转发传输

分组中所有的数据块都到达分组交换机后，分组交换机才会向链路中下一个分组交换机传输该分组。从源到目的发送一个分组，通过由 N 条速率为 R 的链路组成的路径，时延为：*N \* (L / R)*。

#### 3.1.2 排队时延和分组丢失

每个分组交换机都有**输出队列**，用于存储路由器发往某条链路的分组。如果到达的分组发现该链路正在传输其他分组，则该分组就必须在输出队列中等待，等待的时间就是**排队时延**。

因输出队列有大小限制，一个到达的分组可能发现输出队列已经满了，此时该分组会被丢弃，这就是**分组丢失**。

#### 3.1.3 转发路由表和路由转发协议

- 转发路由表：每个路由器都有一个转发路由表，用于将目的地址映射为输出链路。当分组到达某个路由器时，该路由器会检查目的地址，用该地址搜索其转发路由表，以发现适当的输出链路。
- 路由转发协议：因特网具有一些特殊的路由转发协议，用于确认路由转发表。

### 3.2 电路交换

在电路交换中，端系统间会预留沿通信链路传输所需的资源。换句话说，发送端-接收端之间预留了带宽。

#### 3.2.1 电路交换中的复用

分为两种：

- 频分复用（FDM）：所有连接共享链路的频谱，在连接期间，链路为每条连接专设一个频段。
- 时分复用（TDM）：时间被划分为固定时段的帧，每帧又分为固定数量的时隙。当创建一个连接后，会指定每帧中的固定时隙，用于传输该连接的数据。

#### 3.2.2 分组交换与电路交换对比

| 成本     | 成本 | 性能 | 实时性   |
| -------- | ---- | ---- | -------- |
| 分组交换 | 低   | 高   | 不可预测 |
| 电路交换 | 高   | 低   | 可预测   |

 

### 3.3 网络的网络

- 存在点（PoP）：存在于除底层网络等级外的所有网络等级。ISP 中相同位置处一台或多台路由器群组。
- 多宿：任何 ISP 都可以多宿，即与多个提供商 ISP 相连。
- 对等：ISP 之间通过对等可以不进行费用结算。
- 因特网交换点（IXP）：多个 ISP 在 IXP 进行对等。

## 4 分组交换网络中的时延、丢包和吞吐量

理想状态下，我们希望因特网服务能够在任意两个端系统之间随心所欲地瞬间传输数据而没有任何丢失。然而，这是一个极高的目标，实践中难以达到。与之相反，计算机网络必定要限制在端系统之间的吞吐量，还会在端系统之间引入时延，而且实际上也会丢失分组。

### 4.1 时延

思考一个问题，一个分组从上游节点通过路由器A向路由器B发送的过程？

- 分组从上游节点到达路由器A；
- 路由器A检查该分组的首部以决定它的适当的输出链路；
- 当该链路没有其他分组正在传输并且没有其他分组排在该队列前面时，传输该分组；如果链路正忙，则将该分组加入排队；

#### 4.1.1 处理时延

检查分组首部和决定它的适当的输出链路，数量级通常是微秒级或更低的数量级。

#### 4.1.2 排队时延

在队列中，分组在链路上等待传输的时间，数量级通常为毫秒级到微秒级。

#### 4.1.3 传输时延

前面提到的一个分组的传输时间 *L/R s*，数量级通常为毫秒级到微秒级。

#### 4.1.4 传播时延

假设路由器A与路由器B之间的距离为*d*，链路的传播速率为*s*，范围通常为*2e8～3e8 m/s*，等于或略小于光速，则传播时延为 *d/s*，在广域网中，传播时延为毫秒级。

#### 4.1.5 传输时延与传播时延的比较

传输时延：一个分组从路由器发送到链路所用的时间，与分组长度有关；

传播时延：一个比特从路由器A到达路由器B所需的时间，与两个路由器之间的距离有关；

#### 4.1.6 总结

节点总时延 = 节点处理时延 + 排队时延 + 传输时延 + 传播时延

### 4.2 排队时延和丢包

#### 4.2.1 流量强度

假设平均每秒由 *a* 个分组从上游节点到达路由器A，分组到达队列的平均速率为 *a pkt/s*（分组/s）。分组长度为 *L*，传输速率为 *R*，则流量强度为：*La/R*。

当流量强度大于1时，随着时间的增加，排队时延将趋向于无穷大。在流量工程中的一条金科玉律：设计系统时流量强度不能大于1.

#### 4.2.2 丢包

在现实中，排队的容量是有限的，并且随着流量强度接近1，排队时延并不会真正趋向无穷大。相反，当到达的分组将发现一个满的队列，此时这个分组就会被丢弃，也就是丢包。

### 4.3 端到端时延

前面说的是在单台路由器之间的时延，考虑从源到目的地的总时延就是端到端时延。假设在源主机与目的主机之间有 *N - 1* 台路由器，则端到端时延为：

端到端时延 = N * (处理时延 + 排队时延 + 传输时延 + 传播时延)

实际中，在各个节点中具有不同的时延，上述式子是假定所有节点的时延是相同。

### 4.4 计算机网络中的吞吐量

主机A通过因特网向主机B发送一个文件。在任意时刻，**瞬时吞吐量**为主机B接收到该文件的速率，单位*bps*。假设文件大小为*F bit*，主机B接收到该文件用了*T s*，则文件传输的平均吞吐量为*F / T bps*。

瓶颈链路：假设在服务器与客户端之间有 N 条链路，这 N 条链路的传输速率分别为 R1、R2、...、Rn，则服务器与客户端之间的文件传输吞吐量为*min{R1、R2、...、Rn}*。

假设有10个服务器与10个客户端，他们共享一条链路，该链路的传输速率为*5Mbps*，10个客户端同时发生下载，假设瓶颈链路每个服务器的传输速率为*2Mbps*，客户端为*1Mbps*，此时吞吐量为*500kbps*。

## 5 协议层次及其服务模型

### 5.1 分层的体系结构

网络设计者以**分层**的方式组织协议并实现这些协议的网络硬件和软件。每层向他的上一层提供**服务**，即所谓的一层服务模型。每层都有各自的协议，称为**协议栈**。因特网的协议栈由5个层次组成：

- 应用层：一个端系统中的应用程序使用该层的协议，向另一个端系统中的应用程序交换信息分组，该信息分组也被称为**报文**。常用的协议：HTTP、SMTP、FTP。
- 运输层：在应用程序端点之间传送应用层报文，该层的分组被称为**报文段**。在因特网中有两种运输层协议：
  - TCP：面向连接、可靠、流量控制、长报文划分为短报文、拥塞控制
  - UDP：无连接服务、没有可靠性、没有流量控制、没有拥塞控制
- 网络层：将网络层的分组，也称为**数据报**，从一台主机移动到另一台主机。常用的协议：IP。
- 链路层：将分组从一个节点（路由器或主机）移动到路径上的下一个节点，链路层中的分组成为**帧**，因此也可以说，链路层将整个帧从一个网络元素移动到临近的网络元素。。链路层协议决定了链路层提供的服务，例如：以太网、WiFi、电缆接入网的DOCSIS协议。
- 物理层：将一个个比特从一个节点移动到下一个节点。该层的协议仍与链路相关，但会更具体，与实际传输的媒介有关，例如：双绞铜线、单模光纤。

## 5.2 封装

在分层体系结构中，每层协议栈都会对报文进行一层封装。每层封装包含两种类型字段：首部字段以及有效载荷字段。一般来说，有效载荷字段来自于上一层。

## 6 面对攻击的网络

流行的攻击方式：

- 恶意软件
- 拒绝服务攻击（Dos）
  - 弱点攻击
  - 带宽洪泛
  - 链接洪泛
- 嗅探分组
- 信任伪装